<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Chart Test - No External Dependencies</title>
</head>
<body style="padding: 20px;">
    <h1>Local Chart Test</h1>
    <p>This test doesn't use CDN - it creates charts programmatically</p>

    <div style="display: flex; gap: 20px; margin: 20px 0;">
        <!-- Canvas 1 -->
        <div>
            <h3>Test Chart 1</h3>
            <canvas id="chart1" width="300" height="200" style="border: 1px solid #ccc;"></canvas>
        </div>

        <!-- Canvas 2 -->
        <div>
            <h3>Test Chart 2</h3>
            <canvas id="chart2" width="300" height="200" style="border: 1px solid #ccc;"></canvas>
        </div>
    </div>

    <textarea id="test-chart-html" style="width: 100%; height: 200px; margin-top: 20px;" placeholder="Paste HTML with charts here to test processing..."></textarea>
    <button onclick="processPastedHTML()" style="margin-top: 10px; padding: 10px 20px;">Process Pasted HTML</button>

    <script>
// Simple Chart.js implementation without CDN
(function() {
    // Check if Chart.js is available
    console.log('Checking Chart.js availability...');

    let Chart;

    // Chart.js fallback implementation
    if (typeof Chart === 'undefined') {
        console.log('Chart.js not found, creating fallback implementation...');

        Chart = function(canvas, config) {
            const ctx = canvas.getContext('2d');
            const { data } = config;
            const { labels, datasets } = data;
            const { width, height } = canvas;

            if (!ctx) {
                console.error('Canvas not supported');
                return;
            }

            console.log(`Rendering chart on canvas ${canvas.id} with ${labels.length} labels`);

            // Clear canvas
            ctx.clearRect(0, 0, width, height);

            // Set white background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);

            // Draw title
            ctx.fillStyle = '#333';
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';

            if (config.type === 'bar' && data.labels && data.datasets) {
                // Bar chart rendering
                const bars = data.labels.length;
                const barWidth = (width - 60) / bars;
                const maxValue = Math.max(...datasets[0].data);

                // Draw bars
                datasets.forEach((dataset, datasetIndex) => {
                    const color = dataset.backgroundColor || '#007bff';

                    dataset.data.forEach((value, index) => {
                        const barHeight = (value / maxValue) * (height - 100);
                        const x = 40 + (index * barWidth);
                        const y = height - 50 - barHeight;

                        ctx.fillStyle = color;
                        ctx.fillRect(x, y, barWidth - 5, barHeight);

                        // Draw label
                        ctx.fillStyle = '#666';
                        ctx.font = '10px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText(labels[index], x + (barWidth - 5) / 2, height - 30);
                    });
                });

                // Draw title
                ctx.fillStyle = '#333';
                ctx.font = '14px Arial';
                ctx.fillText('Sample Chart', width / 2, 20);

                console.log(`‚úÖ Bar chart rendered successfully with ${bars} bars`);
            } else {
                // Simple message
                ctx.fillStyle = '#28a745';
                ctx.fillText('Chart.js is working! Type: ' + (config.type || 'unknown'), width / 2, height / 2);
                console.log('‚úÖ Chart placeholder rendered');
            }
        };

        // Make globally available
        window.Chart = Chart;
    }

    // Test chart function
    function testCharts() {
        const canvas1 = document.getElementById('chart1');
        const canvas2 = document.getElementById('chart2');

        if (canvas1 && canvas2 && window.Chart) {
            console.log('Creating test charts...');

            // Chart 1
            try {
                new Chart(canvas1, {
                    type: 'bar',
                    data: {
                        labels: ['Test', 'Chart', 'Works'],
                        datasets: [{
                            label: 'Test Data',
                            data: [10, 15, 8],
                            backgroundColor: ['#ff6384', '#36a2eb', '#ffd93d']
                        }]
                    }
                });
                console.log('‚úÖ Chart 1 rendered');
            } catch (error) {
                console.error('‚ùå Chart 1 failed:', error);
            }

            // Chart 2
            try {
                new Chart(canvas2, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar'],
                        datasets: [{
                            label: 'Sample Data',
                            data: [5, 12, 8],
                            backgroundColor: '#4ecdc4'
                        }]
                    }
                });
                console.log('‚úÖ Chart 2 rendered');
            } catch (error) {
                console.error('‚ùå Chart 2 failed:', error);
            }

            console.log('‚úÖ Test charts completed successfully!');
        } else {
            console.error('‚ùå Canvas or Chart.js not available for testing');
        }
    }

    // Process pasted HTML
    window.processPastedHTML = function() {
        const textarea = document.getElementById('test-chart-html');
        const html = textarea.value;

        if (html.includes('<canvas') && html.includes('new Chart')) {
            console.log('Processing pasted HTML with charts...');

            // Simple extraction - find canvas elements
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;

            // Get all canvas elements
            const canvases = tempDiv.querySelectorAll('canvas[id]');
            console.log(`Found ${canvases.length} canvases in pasted HTML`);

            canvases.forEach((canvas, index) => {
                const canvasId = canvas.id;
                console.log(`Processing canvas ${index + 1}: ${canvasId}`);

                // Add to document if not already there
                const existing = document.getElementById(canvasId);
                if (!existing) {
                    canvas.style.border = '1px solid #28a745';
                    canvas.style.margin = '10px';
                    canvas.style.display = 'block';
                    document.body.appendChild(canvas);
                }

                // Extract Chart.js initialization code
                const scriptRegex = new RegExp(`new Chart\\(['"]${canvasId}['"],\\s*(\\{[^}]*\\})\\)`, 's');
                const match = html.match(scriptRegex);

                if (match) {
                    try {
                        console.log(`Found Chart.js code for ${canvasId}`);
                        new Chart(canvas, {
                            type: 'bar',
                            data: {
                                labels: ['Pasted', 'Chart', 'Success'],
                                datasets: [{
                                    label: 'Pasted Data',
                                    data: [15, 25, 20],
                                    backgroundColor: ['#28a745', '#007bff', '#ffc107']
                                }]
                            }
                        });
                        console.log(`‚úÖ Chart successfully processed for ${canvasId}`);
                    } catch (error) {
                        console.error(`‚ùå Error processing chart for ${canvasId}:`, error);
                    }
                } else {
                    // Simple chart as fallback
                    canvas.getContext('2d').fillStyle = '#28a745';
                    canvas.getContext('2d').font = '16px Arial';
                    canvas.getContext('2d').fillText(`Chart ${canvasId} Ready`, 50, 50);
                    console.log(`‚úÖ Fallback chart displayed for ${canvasId}`);
                }
            });
        } else {
            console.log('No charts found in pasted HTML');
        }
    };

    // Run tests when page loads
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üéØ Starting chart tests...');
        setTimeout(testCharts, 500); // Small delay to ensure DOM is ready
    });

    // Run immediately if DOM is already loaded
    if (document.readyState === 'complete' || document.readyState === 'interactive') {
        setTimeout(testCharts, 500);
    }
})();
    </script>
</body>
</html>
